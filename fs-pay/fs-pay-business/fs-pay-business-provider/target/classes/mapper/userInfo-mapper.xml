<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.facishare.pay.business.dao.impl.UserInfoDaoImpl">
    
    <resultMap id="BaseResultMap" type="userInfoDo">
        <id property="id" column="id" />
        <result property="enterpriseAccount" column="enterprise_account" />
        <result property="fsUserId" column="fs_user_id" />
        <result property="status" column="status" typeHandler="com.facishare.pay.common.utils.EnumStatusHandler"/>
        <result property="userName" column="username" />
        <result property="type" column="type" />
        <result property="features" column="features" />
        <result property="password" column="password" />
    </resultMap>
    
    <sql id="All_Column">
        id,
        enterprise_account,
        fs_user_id,
        status,
        username,
        type,
        password,
        features
    </sql>
    
    <!-- 添加用户信息 -->
    <insert id="addUserInfo" parameterType="userInfoDo">
        INSERT INTO user_info(enterprise_account, fs_user_id, status, username, features, type, password)
        VALUES (
                #{enterpriseAccount},
                #{fsUserId},
                #{status, typeHandler=com.facishare.pay.common.utils.EnumStatusHandler},
                #{userName},
                #{features},
                #{type},
                #{password}
            )
    </insert>
    
    <!-- 查询用户信息 -->
    <select id="queryUserInfo" parameterType="map" resultMap="BaseResultMap">
        SELECT 
        <include refid="All_Column"></include>
        FROM user_info
        where enterprise_account = #{enterpriseAccount} AND fs_user_id = #{fsUserId}
    </select>

    <!-- 更新用户信息 -->
    <update id="updateUserInfo" parameterType="userInfoDo">
        UPDATE 
            user_info
            <set>
                <if test="status != null">
                    status = #{status}
                </if>
                <if test="userName != null">
                    ,username = #{userName}
                </if>
                <if test="features != null">
                    ,features = #{features}
                </if>
                <if test="type != null">
                    ,type = #{type}
                </if>
            </set> 
        WHERE 
            enterprise_account = #{enterpriseAccount} 
            AND fs_user_id = #{fsUserId}
    </update>
    
    <!-- 更新用户密码 -->
    <update id="updatePassword" parameterType="map">
        UPDATE 
            user_info
        SET
            password = #{newPassword}
        WHERE 
            enterprise_account = #{enterpriseAccount} 
            AND fs_user_id = #{fsUserId}
            AND password = #{oldPassword}
    </update>
   
   <!-- 分页查询用户信息 -->
    <select id="queryUserInfoPage" parameterType="map" resultMap="BaseResultMap">
        SELECT 
        <include refid="All_Column"></include>
        FROM user_info
        <include refid="userInfoCondition"></include>
        ORDER BY id asc
        limit #{limit} offset #{offset}
    </select>
    
    <!-- 查询用户信息总数 -->
    <select id="queryUserInfoAccount" parameterType="map" resultType="long">
        SELECT 
            COUNT(*)
        FROM user_info
        <include refid="userInfoCondition"></include>
    </select>
   
   <sql id="userInfoCondition">
        <where>
            <if test="enterpriseAccount != null">
                enterprise_account = #{enterpriseAccount}
            </if>
            <if test="fsUserId != null">
                AND fs_user_id = #{fsUserId}
            </if>
            <if test="userName != null">
                AND username like '%${userName}%'
            </if>
            <if test="type != null">
                AND type = #{type}
            </if>
            <if test="status != null">
                AND status = #{status}
            </if>
        </where>
    </sql>
</mapper>
