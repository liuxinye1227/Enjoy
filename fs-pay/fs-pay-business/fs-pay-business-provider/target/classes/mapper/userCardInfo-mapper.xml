<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.facishare.pay.business.dao.impl.UserCardInfoDaoImpl">
    
    <resultMap id="BaseResultMap" type="userCardInfoDo">
        <id property="id" column="id" />
        <result property="bankName" column="bank_name" />
        <result property="bankNo" column="bank_no" />
        <result property="bankBranchName" column="bank_branch_name"/>
        <result property="cardNo" column="card_no" />
        <result property="cardName" column="card_name" />
        <result property="userInfoId" column="user_info_id" />
        <result property="createTime" column="create_time" />
        <result property="updateTime" column="update_time" />
        <result property="bankId" column="bank_id" />
        <result property="bankCode" column="bank_code" />
        <result property="remark" column="remark" />
        <result property="status" column="status" />
    </resultMap>
    
    <sql id="All_Column">
        id,
        bank_name,
        bank_no,
        bank_branch_name,
        card_no,
        card_name,
        user_info_id,
        create_time,
        update_time,
        bank_id,
        bank_code,
        remark,
        status
    </sql>
    
    <!-- 查询可用银行卡绑定 -->
    <select id="queryUserCardInfo" parameterType="map" resultMap="BaseResultMap">
        SELECT 
        <include refid="All_Column"></include>
        FROM user_card_info
        where
            status = 1
            <if test="userInfoId != null">
                AND user_info_id = #{userInfoId}
            </if>
            <if test="cardNo != null">
                AND card_no = #{cardNo}
            </if>
    </select>
    
    <!-- 查询可用银行卡绑定 -->
    <select id="queryUserCardInfoById" parameterType="map" resultMap="BaseResultMap">
        SELECT 
        <include refid="All_Column"></include>
        FROM user_card_info
        where
            id = #{id}
    </select>
    
    <!-- 取消绑定  用户及卡号-->
    <delete id="deleteUserCardInfo" parameterType="map">
        UPDATE user_card_info set status = 2 where user_info_id = #{userInfoId} AND card_no = #{cardNo}
    </delete>
    
    <!-- 添加银行卡绑定 -->
    <insert id="addUserCardInfo" parameterType="userCardInfoDo">
        INSERT INTO user_card_info(
            bank_name,
	        bank_no,
	        bank_branch_name,
	        card_no,
	        user_info_id,
	        create_time,
	        update_time,
	        bank_id,
	        bank_code,
	        remark,
	        status,
	        card_name)
        VALUES (
                #{bankName},
                #{bankNo},
                #{bankBranchName},
                #{cardNo},
                #{userInfoId},
                #{createTime},
                #{updateTime},
                #{bankId},
                #{bankCode},
                #{remark},
                #{status},
                #{cardName}
            )
    </insert>
    
    
    
</mapper>
