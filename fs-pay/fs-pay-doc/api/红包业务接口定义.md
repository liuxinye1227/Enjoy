# 红包业务前后端交互协议

## 说明
> FCP 头部包含employeeId、enterpriseAccount 两个字段

## 实体定义
    
    // 红包接收对象定义
    message Receiver
    {
        required int32 type = 1; // 1. 单人红包 2. 群红包 3. 部门红包
        
        // 如果type=1 或者 type=2，则ID为sessionId
        // 如果type=3 那么id为部门id群组，多个部门ID用 ","分割。因为选择了父部门以后，子部门默认选中，这里只需要传入父部门ID即可
        required string id = 2;
    }
    
    // 红包概要。
    message Summary
    {
        required int senderId = 1;   // 发送人ID
        required string memo = 2;
        required int type = 3;       //红包类型 1. 普通红包 2.拼手气红包
        required int scope = 4;     // 红包范围：1. 单人 2.群 4.营销 5.业务扩展（预留）
        required string senderEa = 5;   // 发送人EA
    }
    
    // 红包详情
    message Info
    {
        required string luckyMoneyId = 1;           // 红包ID
        required int32 senderId = 2;                // 红包发送人ID
        required string memo = 3;                   // 发送红包祝福语
        required int32 type = 4;                    // 红包类型 1. 普通红包 2.拼手气红包
        required string tips = 5;                   // 红包列表顶部提示语. 如"已领取4/7个"等
        
        required bool received = 6;                 // 自己是否抢到
        optional double amount = 7;                 // 如果已抢到红包，此字段不为空。自己抢到的金额
        optional string action = 8;                 // 如果抢到红包给，此字段不为空。领取界面连接名称，如"已存入零钱，可直接转账"
        
        required int32 number = 9;                  // 当前已抢人数量。用于分页。
        repeated UserDetail detail = 10;            // 抢到红包人员名单
        optional int64 timestamp = 11;              // 第一次拉取已抢到红包人员名单时间
        required int32 limit = 12;                  // 每页个数
        required string senderEa = 13;                  // 发送人EA
    }
    
    // 已抢到红包人员信息
    message UserDetail
    {
        required int32 userId = 1;                  // 用户ID
        required int64 timestamp = 2;               // unix 时间戳。单位为ms
        required double amount = 3;                 // 抢到的金额 如0.3
        optional string memo = 4;                   // 红包留言
        optional boolean isLuckiest = 5;            // 是否手气最佳
        required string ea = 6;
    }

## 查询红包金额限制
Method | QueryName | Argument | ResultType | Description
-----  |------     |----      |----        | -------
Query      | FHE/EM1ALM/LuckyMoney/GetLuckyMoneyLimit         | GetLuckyMoneyLimitArg        | GetLuckyMoneyLimitResult          | 查询红包金额限制

    message GetLuckyMoneyLimitArg
    {
        
    }
    
    message GetLuckyMoneyLimitResult
    {
        required int32 errorCode = 1;               //0表示成功，其它表示失败
        required string errorMsg = 2;               //如果错误码不为0,此字段为错误信息摘要，如果为0,此字段为success
        required int32 normalMinNumber = 3;   //普通红包最小数量 1  
        required int32 normalMaxNumber = 4;   //普通红包最大数量 100
        required double normalMinAmount = 5;  //普通红包单个最小金额 0.01
        required double normalMaxAmount = 6;  //普通红包单个最大金额 500
        
        required int32 luckyMinNumber = 7;    //拼手气红包最小数量 1
        required int32 luckyMaxNumber = 8;    //拼手气红包最大数量 100  
        required double luckyMinAmount = 9;   //拼手气红包单个最小金额 0.01
        required double luckyMaxAmount = 10;   //拼手气红包总金额最大值 10000
        
        required double luckySingleMaxAmount = 11； //拼手气红包单个最大金额 500
        required double normalTotalMaxAmount = 12；  //普通红包最大总金额  10000
        
    }

## 塞钱进红包
Method | QueryName | Argument | ResultType | Description
-----  |------     |----      |----        | -------
Query      | FHE/EM1ALM/LuckyMoney/PackLuckyMoney         | PackLuckyMoneyArg        | PackLuckyMoneyResult          | 发红包 
  
    message PackLuckyMoneyArg
    {
        required Receiver receiver = 1;    // 红包接收对象
        required int32 type = 2;           // 1。 普通红包  2. 拼手气红包. 如果receiver.type类型为1，此字段值恒等于1
        required double amount = 3;        // 如果红包为普通红包，则此金额为单个红包金额；如果红包为拼手气红包，则此金额为总金额
        required int32 number = 4;         // 红包个数，receiver.type = 1 时， 此字段值为1 
        required string memo = 5;          // 祝福语
    }
    
    message PackLuckyMoneyResult
    {
        required int32 errorCode = 1;       //0表示成功，其它表示失败
        required string errorMsg = 2;       //如果错误码不为0,此字段为错误信息摘要，如果为0,此字段为success
        optional string luckyMoneyId = 3;   //红包ID
        optional string merchantId = 4;     //商户ID
        optional string wareId = 5;         //商品ID
        optional string wareName = 6;       //商品名称
        optional double totalAmount = 7;    //红包总金额
    }

    
## 转发红包
Method | QueryName | Argument | ResultType | Description
-----  |------     |----      |----        | -------
Query      | FHE/EM1ALM/LuckyMoney/ForwardLuckyMoney         | ForwardLuckyMoneyArg        | ForwardLuckyMoneyResult          | 转发红包 


    message ForwardLuckyMoneyArg
    {
        required string luckyMoneyId = 1; //红包ID
        required Received receiver = 2;  //转发红包接收对象, 此时receiver.type不能为3
    }
    
    message ForwardLuckyMoneyResult
    {
        required int32 errorCode = 1;   //0表示成功，其它表示失败
        required string errorMsg = 2;   //如果错误码不为0,此字段为错误信息摘要，如果为0,此字段为success
    }


## 抢红包
Method | QueryName | Argument | ResultType | Description
-----  |------     |----      |----        | -------
Query      | FHE/EM1ALM/LuckyMoney/GrabLuckyMoney         | GrabLuckyMoneyArg        | GrabLuckyMoneyResult          | 抢红包

    message GrabLuckyMoneyArg
    {
        required string luckyMoneyId = 1; //红包id
    }
    
    message GrabLuckyMoneyResult
    {
        required int32 errorCode = 1; //0表示成功，其它表示失败
        required string errorMsg = 2; //如果错误码不为0,此字段为错误信息摘要，如果为0,此字段为success
        
        optional int32 result = 3;    // 1.正常(表示红包可以被当前用户抢,显示拆红包界面)  2.已抢完  3.已过期  4.自己发送的红包自己不能抢 5.已抢到
        optional Summary summary = 4; // 红包概要
    }


## 拆红包
Method | QueryName | Argument | ResultType | Description
-----  |------     |----      |----        | -------
Query      | FHE/EM1ALM/LuckyMoney/UnpackLuckyMoney         | UnpackLuckyMoneyArg        | UnpackLuckyMoneyResult          | 拆红包

    message UnpackLuckyMoneyArg
    {
        required string luckyMoneyId = 1; //红包id
    }
    
    message UnpackLuckyMoneyResult
    {
        required int32 errorCode = 1;        //0表示成功，其它表示失败
        required string errorMsg = 2;        //如果错误码不为0,此字段为错误信息摘要，如果为0,此字段为success
        optional int32 result = 3;           //抢红包结果。1.正常(表示红包可以被当前用户抢,显示拆红包界面)  2.已抢完  3.已过期  4.自己发送的红包自己不能抢 5.已抢到
    }
    
    
## 查询红包详情
Method | QueryName | Argument | ResultType | Description
-----  |------     |----      |----        | -------
Query      | FHE/EM1ALM/LuckyMoney/GetLuckyMoneyInfo       | GetLuckyMoneyInfoArg        | GetLuckyMoneyInfoResult   | 查询红包详情

    message GetLuckyMoneyInfoArg
    {
        required string luckyMoneyId = 1; //红包id
    }
    
    message GetLuckyMoneyInfoResult
    {
        required int32 errorCode = 1;        //0表示成功，其它表示失败
        required string errorMsg = 2;        //如果错误码不为0,此字段为错误信息摘要，如果为0,此字段为success
        optional Info info = 3;              // 红包详情
    }

## 分页获取已抢到红包人员列表
Method | QueryName | Argument | ResultType | Description
-----  |------     |----      |----        | -------
Query  | FHE/EM1ALM/LuckyMoney/GetReceivedUserDetail        | GetReceivedUserDetailArg        | GetReceivedUserDetailResult | 获取已抢到用户列表

    message GetReceivedUserDetailArg
    {
        required string luckyMoneyId = 1; // 红包ID
        required int32 page = 2;          // 分页参数。因为第一页用户信息在GetLuckyMoneyInfo中已经给出。所以调用此接口时值最小为2
        required int64 timestamp = 3;     // 时间戳。  值为GetLuckyMoneyInfoResult.info中给出
    }
    
    message GetReceivedUserDetailResult
    {
        required int32 errorCode = 1;        //0表示成功，其它表示失败
        required string errorMsg = 2;        //如果错误码不为0,此字段为错误信息摘要，如果为0,此字段为success
        repeated UserDetail userDetail = 3;  //已抢到用户列表
        required int64 timestamp = 4;        //时间戳. 值为GetLuckyMoneyInfoResult.info中给出
    }
    
## 留言
Method | QueryName | Argument | ResultType | Description
-----  |------     |----      |----        | -------
Query      | FHE/EM1ALM/LuckyMoney/LeaveLuckyMemo         | LeaveLuckyMemoArg        | LeaveLuckyMemoResult          | 抢到红包后发送留言信息

    message LeaveLuckyMemoArg
    {
        required string luckyMoneyId = 1; //红包id
        required string memo = 2; //留言信息
    }
    
    message LeaveLuckyMemoResult
    {
        required int32 errorCode = 1;    //0表示成功，其它表示失败
        required string errorMsg = 2;    //如果错误码不为0,此字段为错误信息摘要，如果为0,此字段为success
    }

## 查询我发出的红包
Method | QueryName | Argument | ResultType | Description
-----  |------     |----      |----        | -------
Query      | FHE/EM1ALM/LuckyMoney/GetSentInfo         | GetSentInfoArg        | GetSentInfoResult          | 查询我发出的红包信息

    message GetSentInfoArg
    {
        required int32 page = 1; //分页参数，每次拉取数量固定为10
    }
    
    message GetSentInfoResult
    {
        required int32 errorCode = 1;    //0表示成功，其它表示失败
        required string errorMsg = 2;    //如果错误码不为0,此字段为错误信息摘要，如果为0,此字段为success
        optional int32 number = 3;  //总共发送的数量
        optional double amount = 4; //总共发送的金额
        repeated SentDetail sentDetail = 5; // 详情
        required int32 limit = 6;           // detail 每页个数
    }
    
    message SentDetail
    {
        required int32 type = 1;             //红包类型 1，普通红包; 2，拼手气红包；
        required double amount = 2;          //发送的总金额
        required int32 number = 3;          //已抢个数
        required int32 totalNumber = 4;     //发送的总数量
        required int32 status = 5;           //1. 未抢完  2. 已抢完 3. 已过期
        required long time = 6;            //发送时间。Unix 时间戳
        required string luckyMoneyId = 7;    //红包ID
    }

## 查询我收到的红包

Method | QueryName | Argument | ResultType | Description
-----  |------     |----      |----        | -------
Query      | FHE/EM1ALM/LuckyMoney/GetReceivedInfo         | GetReceivedInfoArg        | GetReceivedInfoResult          | 查询我收到的红包信息


    message GetReceivedInfoArg
    {
        required int32 page = 1;  //分页参数，每次拉取数量固定为10
    }
    
    message GetReceivedInfoResult
    {
        required int32 errorCode = 1;               //0表示成功，其它表示失败
        required string errorMsg = 2;               //如果错误码不为0,此字段为错误信息摘要，如果为0,此字段为success
        optional double amount = 3;                 //总共收到的金额
        optional int32 number = 4;                  //总共抢到的个数
        optional int32 luckiestNumber = 5;          //手气最佳次数
        repeated ReceivedDetail receivedDetail = 6; //收到红包详情
        required int32 limit = 7;                   // detail 每页个数
    }
    
    message ReceivedDetail
    {
        required int64 time = 1;                    //收到时间.unix 时间戳,单位MS
        required int32 senderId = 2;                //发送人ID
        required double amount = 3;                 //抢到的金额
        required string luckyMoneyId = 4;           //红包ID
        required bool isLuckiest = 5;               //是否是手气最佳
        required int32 type = 6;                    //1。 普通红包  2. 拼手气红包
        required int32 scope = 7;                    // 红包范围（1，单人；2，群；3，部门；4，营销）
        required string senderEa = 8;                    // 发送人EA
    }